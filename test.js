var ColorCalculator=Backbone.Model.extend({initialize:function(n){this.logger=Logger("#log",10),this.result=$("#deltaE"),this.adapter=n,this.models={};var t=this,i=Backbone.Model.extend({});$(".colorForm").each(function(){t.models[this.id]=t.newColorView("#"+this.id,i)}),$("#submit").click(function(){t.calculate()}),$(".inputForm input").blur(function(){var n=$(this),t=parseFloat(n.val(),10),r=parseFloat(n.attr("min"),10),i=parseFloat(n.attr("max"),10);(isNaN(t)||r>t||t>i)&&(alert("Invalid value entered. Value must be between "+r+" and "+i),n.val(i)),$(this).parent().siblings(".help-inline").fadeOut()});$(".picker").colorpicker().on("hide",function(n){var i=n.color.toRGB(),r=$(this);r.css("background-color",n.color.toHex()),t.updateInput(this,i,"Rgb",!0)});$(".colorSpaceSelector").change(function(){$(this).siblings(".colorForm").hide(),$(this).siblings().find("input").val(""),$(this).siblings("."+this.value).show()}),$(".colorForm input").focus(function(){$(this).parent().siblings(".help-inline").show()})},getModel:function(n){return this.models[n.id].model},updateInput:function(n,t,i,r){var u=this;return $.ajax({url:"/api/"+i+"/Translate",type:"Post",data:t,success:function(t){r?u.updateFields(n,t):u.changePicker(n,t)},error:function(n,t,i){var r="Error  "+t+" "+i;n.responseText&&n.responseText[0]=="{"&&(r=JSON.parse(n.responseText).message),console.log(r)}}),!1},changePicker:function(n,t){var i="rgb("+Math.round(t.Rgb.Members[0].Value)+","+Math.round(t.Rgb.Members[1].Value)+","+Math.round(t.Rgb.Members[2].Value)+")";n.css("background-color",i)},updateFields:function(n,t){var u=$(n).parent().parent().parent(),r=u.attr("id"),f=r.split("-")[0],i;$(t[f].Members).each(function(){i=$("#"+r+"-"+this.Label),i.val(this.Value)}),i.change()},calculate:function(){var i=this.adapter,r=$(".colorForm:visible"),n=i.getInput({A:this.getModel(r[0]).attributes,B:this.getModel(r[1]).attributes}),u=i.getMessage(this.getColorData(n.A),this.getColorData(n.B),n),t=this.result,f=this.logger;return t.parent().hide(),$.ajax({url:this.adapter.getUrl(),type:"Get",data:"request="+JSON.stringify(n),success:function(n){t.html(n),t.parent().fadeIn(200),f.log("<strong class='text-success'>"+n+"<\/strong> = "+u)},error:this.error}),!1},newColorView:function(n,t){var i=this,r=Backbone.View.extend({el:n,events:{"change input":"changed"},initialize:function(){_.bindAll(this,"changed"),this.inputContent=this.$("input.content")},changed:function(n){var t=$(n.currentTarget).parent().parent().parent().find("input"),i={Type:t[0].id.split("-")[0]};t.each(function(){var n=$(this);i[n.attr("name")]=n.val()}),this.model.attributes=i,this.updateColor(this.model.attributes)},updateColor:function(){var n=$(this.el).parent().find(".picker");i.updateInput(n,this.model.attributes,this.model.attributes.Type,!1)}});return new r({model:new t})},error:function(n,t,i){var r="Error  "+t+" "+i;n.responseText&&n.responseText[0]=="{"&&(r=JSON.parse(n.responseText).message),console.log(r)},getColorData:function(n){var t=jQuery.extend({},n);return delete t.Type,JSON.stringify(t).replace(/["{}]/g,"")}});calculator=new ColorCalculator({applicationField:$("#Application"),initialize:function(n){$("#Application").change(n)},getUrl:function(){return"/api/Cie94/Compare"},getInput:function(n){return n.Application=this.applicationField.val(),n},getMessage:function(n,t,i){return n+" -> "+t+" ("+i.Application+")"}})